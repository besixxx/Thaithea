<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ThaiThae Premium | Full Edition</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ffffff">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@200;300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root { 
            --sat: env(safe-area-inset-top); 
            --sab: env(safe-area-inset-bottom);
            --thai-red: #a50000;
            --thai-bg: #fdfdfd;
        }

        body { font-family: 'Kanit', sans-serif; background-color: var(--thai-bg); margin: 0; min-height: 100svh; display: flex; flex-direction: column; padding-bottom: calc(85px + var(--sab)); }
        header { padding-top: calc(var(--sat) + 1rem); background: white; border-bottom: 3px solid var(--thai-red); box-shadow: 0 2px 15px rgba(0,0,0,0.05); }
        
        /* üö© Banner Style */
        .banner-container { padding: 20px 20px 10px 20px; }
        .banner-wrapper {
            width: 100%; height: 160px;
            background: linear-gradient(135deg, var(--thai-red) 0%, #ff4d4d 100%);
            border-radius: 2.5rem; position: relative; overflow: hidden;
            display: flex; align-items: center; padding: 25px;
            box-shadow: 0 10px 25px rgba(165, 0, 0, 0.15);
        }
        .banner-content { color: white; z-index: 2; }
        .banner-circle {
            position: absolute; right: -20px; bottom: -20px;
            width: 150px; height: 150px;
            background: rgba(255, 255, 255, 0.1); border-radius: 50%;
        }

        .product-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; padding: 20px; }
        .product-card { background: white; border-radius: 1.5rem; overflow: hidden; border: 1px solid #f0f0f0; display: flex; flex-direction: column; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.02); }
        
        .glass-nav { position: fixed; bottom: 0; left: 0; right: 0; height: calc(70px + var(--sab)); background: white; border-top: 1px solid #eeeeee; padding-bottom: var(--sab); display: flex; justify-content: space-around; align-items: center; z-index: 50; border-radius: 2rem 2rem 0 0; box-shadow: 0 -5px 25px rgba(0,0,0,0.05); }
        .active-nav { color: var(--thai-red); transform: translateY(-2px); }
        .nav-btn { color: #bbbbbb; transition: 0.3s; }

        #loginPage { position: fixed; inset: 0; z-index: 1000; background: var(--thai-bg); display: flex; align-items: center; justify-content: center; }
        .tab-content { display: none; flex: 1; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease-out; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .btn-red { background: var(--thai-red); color: white; }
        .status-pill { padding: 2px 10px; border-radius: 20px; font-size: 10px; font-weight: bold; }
        .status-pending { background: #fff7ed; color: #c2410c; }
        .status-shipping { background: #eff6ff; color: #1d4ed8; }
        .status-success { background: #f0fdf4; color: #15803d; }

        /* üìç POPUP STYLES */
        #orderDetailModal { 
            position: fixed; inset: 0; z-index: 2000; 
            background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(10px); 
            display: none; align-items: center; justify-content: center; padding: 20px; 
        }
        .modal-content { 
            background: white; width: 100%; max-width: 400px; 
            border-radius: 2.5rem; overflow: hidden; 
            animation: modalFadeUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }
        @keyframes modalFadeUp { from { opacity: 0; transform: translateY(60px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="loginPage">
        <div class="w-full max-w-xs space-y-6 px-6 text-center">
            <h1 class="text-4xl font-black italic">THAI<span class="text-[var(--thai-red)]">THAE</span></h1>
            <div class="space-y-3">
                <input id="loginUser" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" class="w-full bg-white p-4 rounded-2xl border outline-none font-bold">
                <input id="loginPass" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (1234)" class="w-full bg-white p-4 rounded-2xl border outline-none font-bold">
                <button id="btnLogin" class="w-full btn-red py-4 rounded-2xl font-bold shadow-lg shadow-red-100 uppercase tracking-widest">Login</button>
            </div>
        </div>
    </div>

    <div id="homeTab" class="tab-content">
        <header class="px-6 pb-5 sticky top-0 z-40">
            <div class="flex justify-between items-end">
                <div>
                    <h1 class="text-xl font-black text-slate-800 leading-none italic">ThaiThae</h1>
                    <p id="roleLabel" class="text-[9px] text-[var(--thai-red)] font-bold italic mt-1 uppercase tracking-tighter"></p>
                </div>
                <button id="headerCartBtn" onclick="switchTab('cartTab', document.getElementById('btnCart'))" class="p-3 bg-slate-50 rounded-2xl relative">
                    <i data-lucide="shopping-basket"></i>
                    <span id="cartCount" class="absolute -top-1 -right-1 bg-[var(--thai-red)] text-white text-[9px] w-5 h-5 rounded-full flex items-center justify-center border-2 border-white font-bold hidden">0</span>
                </button>
            </div>
        </header>

        <div id="userBanner" class="banner-container">
            <div class="banner-wrapper">
                <div class="banner-content">
                    <p class="text-[10px] font-bold uppercase tracking-widest opacity-80 mb-1">Exclusive Offer</p>
                    <h2 class="text-2xl font-black italic leading-tight">THAITHAE<br><span class="text-white/80 font-medium">PREMIUM 2026</span></h2>
                    <button class="mt-3 bg-white text-[var(--thai-red)] px-5 py-2 rounded-full text-[9px] font-black uppercase shadow-sm active:scale-95 transition-all">‡∏ä‡πâ‡∏≠‡∏õ‡πÄ‡∏•‡∏¢</button>
                </div>
                <div class="banner-circle" style="width: 120px; height: 120px; top: -30px; right: 20px;"></div>
                <div class="banner-circle"></div>
                <i data-lucide="sparkles" class="absolute right-10 top-1/2 -translate-y-1/2 w-16 h-16 text-white/10"></i>
            </div>
        </div>

        <main id="productGrid" class="product-grid"></main>
    </div>

    <div id="cartTab" class="tab-content">
        <header class="p-6 bg-white border-b"><h2 class="text-2xl font-black italic">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2></header>
        <div id="cartList" class="p-6 space-y-3"></div>
        
        <div id="shippingForm" class="px-6 pb-48 space-y-4 hidden">
            <div class="bg-white p-6 rounded-3xl border shadow-sm space-y-3">
                <p class="font-bold text-sm text-slate-800 border-b pb-2 flex gap-2 items-center"><i data-lucide="truck" class="w-4 h-4 text-[var(--thai-red)]"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</p>
                <input id="shipName" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö" class="w-full bg-slate-50 p-3 rounded-xl border text-sm font-bold outline-none focus:border-[var(--thai-red)]">
                <input id="shipPhone" type="tel" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠" class="w-full bg-slate-50 p-3 rounded-xl border text-sm font-bold outline-none focus:border-[var(--thai-red)]">
                <textarea id="shipAddress" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á (‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡πÅ‡∏Ç‡∏ß‡∏á, ‡πÄ‡∏Ç‡∏ï, ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î)" class="w-full bg-slate-50 p-3 rounded-xl border text-sm font-bold outline-none h-24 focus:border-[var(--thai-red)]"></textarea>
            </div>
        </div>

        <div id="cartSummary" class="px-6 fixed bottom-24 left-0 right-0 hidden z-30">
            <div class="bg-white p-6 rounded-[2.5rem] border shadow-2xl">
                <div class="flex justify-between mb-4"><span class="font-bold text-slate-400">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</span><span id="totalPrice" class="text-3xl font-black text-[var(--thai-red)]">‡∏ø0</span></div>
                <button onclick="processOrder()" class="w-full btn-red py-5 rounded-2xl font-black text-xl active:scale-95 transition-all">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
            </div>
        </div>
    </div>

    <div id="historyTab" class="tab-content px-6 pt-6">
        <h2 class="text-2xl font-black text-slate-800 italic mb-6">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>
        <div id="orderList" class="space-y-4 pb-32"></div>
    </div>

    <div id="adminTab" class="tab-content px-6 pt-6">
        <h2 class="text-2xl font-black text-slate-800 italic mb-6">‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
        <div class="bg-white p-6 rounded-3xl border shadow-sm space-y-4 mb-8">
            <input id="pName" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà" class="w-full bg-slate-50 p-4 rounded-xl outline-none font-bold text-sm">
            <div class="flex gap-3">
                <input id="pPrice" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" class="w-1/2 bg-slate-50 p-4 rounded-xl outline-none font-bold">
                <input id="pStock" type="number" placeholder="‡∏™‡∏ï‡πá‡∏≠‡∏Å" class="w-1/2 bg-slate-50 p-4 rounded-xl outline-none font-bold">
            </div>
            <input id="pImage" type="text" placeholder="URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" class="w-full bg-slate-50 p-3 rounded-xl outline-none text-[10px]">
            <button id="btnSave" class="w-full btn-red py-4 rounded-xl font-bold active:scale-95 transition-all">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô</button>
        </div>
        <div id="adminList" class="space-y-4 pb-32"></div>
    </div>

    <div id="orderDetailModal">
        <div class="modal-content shadow-2xl">
            <div id="modalData" class="p-8 space-y-6"></div>
            <button onclick="closeOrderModal()" class="w-full bg-slate-50 py-5 font-black text-slate-400 uppercase tracking-widest text-xs border-t active:bg-slate-100">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
        </div>
    </div>

    <nav id="bottomNav" class="glass-nav hidden">
        <button onclick="switchTab('homeTab', this)" class="nav-btn active-nav p-4"><i data-lucide="layout-grid"></i></button>
        <button id="btnCart" onclick="switchTab('cartTab', this)" class="nav-btn p-4"><i data-lucide="shopping-bag"></i></button>
        <button onclick="switchTab('historyTab', this)" class="nav-btn p-4"><i data-lucide="clipboard-list"></i></button>
        <button id="adminNavBtn" onclick="switchTab('adminTab', this)" class="nav-btn p-4 hidden"><i data-lucide="package"></i></button>
        <button onclick="logout()" class="text-slate-200 p-4"><i data-lucide="power"></i></button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBhV0tNPY5EeiOkIp63U-20rNjscA9WW_s",
            authDomain: "thaithae-ba227.firebaseapp.com",
            databaseURL: "https://thaithae-ba227-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "thaithae-ba227",
            storageBucket: "thaithae-ba227.firebasestorage.app",
            messagingSenderId: "749954534670",
            appId: "1:749954534670:web:bc8e00d9e320dc8d92db5f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const productsRef = ref(db, 'products');
        const ordersRef = ref(db, 'orders');

        window.cart = [];
        window.currentUser = '';
        window.currentUserRole = 'customer';

        function loadProducts() {
            onValue(productsRef, (snapshot) => {
                const data = snapshot.val();
                const grid = document.getElementById('productGrid');
                const list = document.getElementById('adminList');
                grid.innerHTML = ''; list.innerHTML = '';
                if (!data) return;

                Object.keys(data).forEach(key => {
                    const item = data[key];
                    const stock = item.stock || 0;
                    const hideForAdmin = window.currentUserRole === 'admin' ? 'hidden' : '';

                    grid.innerHTML += `
                        <div class="product-card">
                            <img src="${item.image}" class="h-40 w-full object-cover">
                            <div class="p-4 flex flex-col flex-1">
                                <span class="bg-red-50 text-[var(--thai-red)] text-[9px] font-bold px-2 py-0.5 rounded w-fit mb-1 italic">‡∏Ñ‡∏•‡∏±‡∏á: ${stock}</span>
                                <h3 class="font-bold text-xs line-clamp-1">${item.name}</h3>
                                <p class="text-[var(--thai-red)] font-black text-lg">‡∏ø${item.price.toLocaleString()}</p>
                                <button onclick="addToCart('${key}','${item.name}',${item.price},'${item.image}',${stock})" 
                                    class="mt-3 w-full btn-red py-2.5 rounded-xl text-[10px] font-bold ${hideForAdmin} ${stock <= 0 ? 'opacity-20 pointer-events-none' : ''}">
                                    ${stock > 0 ? '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤' : '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î'}
                                </button>
                            </div>
                        </div>`;
                    
                    list.innerHTML += `
                        <div class="bg-white p-4 rounded-2xl flex justify-between items-center border">
                            <div class="flex items-center gap-3"><img src="${item.image}" class="w-12 h-12 object-cover rounded-xl shadow-sm"><div><p class="font-bold text-sm text-slate-800">${item.name}</p><p class="text-[10px] text-blue-500 font-bold uppercase tracking-widest">STOCK: ${stock}</p></div></div>
                            <div class="flex gap-2"><button onclick="addStock('${key}',${stock})" class="p-2 text-blue-600 bg-blue-50 rounded-lg"><i data-lucide="plus" class="w-4 h-4"></i></button><button onclick="deleteOnlineProduct('${key}')" class="p-2 text-slate-300"><i data-lucide="trash-2" class="w-4 h-4"></i></button></div>
                        </div>`;
                });
                lucide.createIcons();
            });
        }

        window.processOrder = () => {
            const name = document.getElementById('shipName').value.trim();
            const phone = document.getElementById('shipPhone').value.trim();
            const addr = document.getElementById('shipAddress').value.trim();
            if (!name || !phone || !addr) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö‡∏ô‡∏≤‡∏¢!");

            const total = window.cart.reduce((sum, item) => sum + item.price, 0);
            const newOrder = {
                user: window.currentUser,
                customerInfo: { name, phone, address: addr },
                items: window.cart,
                total: total,
                status: 'pending',
                timestamp: Date.now()
            };

            push(ordersRef, newOrder).then(() => {
                window.cart.forEach(cartItem => {
                    onValue(ref(db, `products/${cartItem.id}`), (snap) => {
                        const p = snap.val();
                        if(p) update(ref(db, `products/${cartItem.id}`), { stock: p.stock - 1 });
                    }, { onlyOnce: true });
                });
                alert("‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö!");
                window.cart = [];
                document.getElementById('cartCount').classList.add('hidden');
                document.querySelectorAll('#shippingForm input, #shippingForm textarea').forEach(i => i.value = '');
                window.switchTab('historyTab', document.querySelector('[onclick*="historyTab"]'));
            });
        };

        function loadOrders() {
            onValue(ordersRef, (snapshot) => {
                const data = snapshot.val();
                const list = document.getElementById('orderList');
                list.innerHTML = '';
                if (!data) return list.innerHTML = '<div class="py-20 text-center opacity-10"><i data-lucide="package-open" class="mx-auto w-12 h-12"></i><p class="mt-2 text-xs font-bold">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p></div>';

                const orders = Object.keys(data).map(key => ({id: key, ...data[key]})).reverse();
                orders.forEach(order => {
                    if (window.currentUserRole !== 'admin' && order.user !== window.currentUser) return;
                    let statusClass = order.status === 'pending' ? 'status-pending' : (order.status === 'shipping' ? 'status-shipping' : 'status-success');
                    let statusText = order.status === 'pending' ? '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö' : (order.status === 'shipping' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á' : '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');

                    list.innerHTML += `
                        <div onclick="openOrderModal('${order.id}')" class="bg-white p-5 rounded-2xl border shadow-sm active:scale-95 transition-all flex justify-between items-center cursor-pointer border-l-4 ${order.status === 'success' ? 'border-l-green-400' : 'border-l-[var(--thai-red)]'}">
                            <div>
                                <p class="text-[9px] font-bold text-slate-300 italic">#${order.id.slice(-6)}</p>
                                <p class="text-sm font-black text-slate-800">‡∏ø${order.total.toLocaleString()}</p>
                            </div>
                            <div class="text-right">
                                <span class="status-pill ${statusClass}">${statusText}</span>
                                <p class="text-[9px] text-slate-400 mt-1">${new Date(order.timestamp).toLocaleDateString('th-TH')}</p>
                            </div>
                        </div>`;
                });
                lucide.createIcons();
            });
        }

        window.openOrderModal = (orderId) => {
            onValue(ref(db, `orders/${orderId}`), (snap) => {
                const order = snap.val();
                if (!order) return;
                const info = order.customerInfo || { name: '-', phone: '-', address: '-' };
                const modalData = document.getElementById('modalData');
                modalData.innerHTML = `
                    <div class="text-center">
                        <div class="w-12 h-12 bg-red-50 text-[var(--thai-red)] rounded-full flex items-center justify-center mx-auto mb-3"><i data-lucide="package"></i></div>
                        <h3 class="text-lg font-black uppercase tracking-tighter italic">Order Detail</h3>
                        <p class="text-[9px] text-slate-300 font-bold tracking-widest">${orderId}</p>
                    </div>
                    <div class="space-y-2 bg-slate-50 p-5 rounded-3xl text-[11px] leading-relaxed border border-slate-100">
                        <p><b>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö:</b> ${info.name}</p><p><b>‡πÇ‡∏ó‡∏£:</b> ${info.phone}</p><p><b>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</b> ${info.address}</p>
                    </div>
                    <div class="space-y-3 border-t pt-5">
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á</p>
                        ${order.items.map(i => `<div class="flex justify-between text-xs"><span>${i.name}</span><b class="text-slate-700">‡∏ø${i.price}</b></div>`).join('')}
                        <div class="flex justify-between pt-3 border-t-2 border-dashed font-black text-xl text-[var(--thai-red)]"><span>‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span><span>‡∏ø${order.total.toLocaleString()}</span></div>
                    </div>
                    ${window.currentUserRole === 'admin' ? `
                        <div class="pt-5 border-t">
                            <p class="text-[10px] font-black mb-3 text-blue-500 uppercase tracking-widest flex items-center gap-2"><i data-lucide="shield-check" class="w-3 h-3"></i> ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</p>
                            <select onchange="updateOrderStatus('${orderId}', this.value)" class="w-full bg-slate-100 p-4 rounded-2xl font-bold outline-none text-sm appearance-none border-2 border-transparent focus:border-blue-200">
                                <option value="pending" ${order.status==='pending'?'selected':''}>‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
                                <option value="shipping" ${order.status==='shipping'?'selected':''}>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á</option>
                                <option value="success" ${order.status==='success'?'selected':''}>‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</option>
                            </select>
                        </div>
                    ` : ''}`;
                document.getElementById('orderDetailModal').style.display = 'flex';
                lucide.createIcons();
            }, { onlyOnce: true });
        };

        window.closeOrderModal = () => document.getElementById('orderDetailModal').style.display = 'none';
        window.updateOrderStatus = (id, status) => update(ref(db, `orders/${id}`), { status });
        
        document.getElementById('btnLogin').onclick = () => {
            const user = document.getElementById('loginUser').value.trim();
            const pass = document.getElementById('loginPass').value;
            if (pass === "1234" && user !== "") {
                window.currentUser = user;
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('bottomNav').classList.remove('hidden');
                document.getElementById('homeTab').classList.add('active');
                if (user.toLowerCase() === "admin") {
                    window.currentUserRole = 'admin';
                    document.getElementById('adminNavBtn').classList.remove('hidden');
                    document.getElementById('btnCart').classList.add('hidden');
                    document.getElementById('headerCartBtn').classList.add('hidden');
                    document.getElementById('userBanner').classList.add('hidden'); // ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡πÇ‡∏ä‡∏ß‡πå‡∏´‡∏ô‡πâ‡∏≤ Admin
                }
                document.getElementById('roleLabel').innerText = user.toUpperCase() + " ACCESS";
                loadProducts(); loadOrders();
            } else { alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ!"); }
        };

        window.switchTab = (tabId, btn) => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(n => n.classList.remove('active-nav'));
            if(btn && btn.classList.contains('nav-btn')) btn.classList.add('active-nav');
            if(tabId === 'cartTab') renderCart();
            lucide.createIcons();
        };

        window.addToCart = (id, name, price, image, stock) => {
            const inCart = window.cart.filter(i => i.id === id).length;
            if (inCart >= stock) return alert("‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏ô‡∏≤‡∏¢! ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö");
            window.cart.push({id, name, price, image});
            document.getElementById('cartCount').innerText = window.cart.length;
            document.getElementById('cartCount').classList.remove('hidden');
        };

        window.renderCart = () => {
            const list = document.getElementById('cartList');
            const summary = document.getElementById('cartSummary');
            const form = document.getElementById('shippingForm');
            list.innerHTML = ''; let total = 0;
            if(window.cart.length === 0) { 
                list.innerHTML = '<div class="py-20 text-center opacity-10"><i data-lucide="shopping-cart" class="mx-auto w-12 h-12"></i><p class="mt-2 text-xs font-bold uppercase tracking-widest">Cart is empty</p></div>'; 
                summary.classList.add('hidden'); form.classList.add('hidden'); 
                return; 
            }
            window.cart.forEach((item, index) => {
                total += item.price;
                list.innerHTML += `<div class="bg-white p-4 rounded-2xl flex justify-between items-center border">
                    <div class="flex items-center gap-4"><img src="${item.image}" class="w-12 h-12 object-cover rounded-xl shadow-sm"><div><p class="font-bold text-xs">${item.name}</p><p class="text-[var(--thai-red)] font-black text-sm">‡∏ø${item.price.toLocaleString()}</p></div></div>
                    <button onclick="window.cart.splice(${index},1);window.renderCart();" class="p-2 text-slate-200"><i data-lucide="x-circle" class="w-5 h-5"></i></button></div>`;
            });
            document.getElementById('totalPrice').innerText = `‡∏ø${total.toLocaleString()}`;
            summary.classList.remove('hidden'); form.classList.remove('hidden'); 
            lucide.createIcons();
        };

        document.getElementById('btnSave').onclick = () => {
            const name = document.getElementById('pName').value;
            const price = document.getElementById('pPrice').value;
            const stock = document.getElementById('pStock').value;
            const image = document.getElementById('pImage').value;
            if(name && price && stock && image) {
                push(productsRef, { name, price: Number(price), stock: Number(stock), image });
                alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                document.querySelectorAll('#adminTab input').forEach(i => i.value = '');
            } else { alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö‡∏ô‡∏≤‡∏¢!"); }
        };

        window.addStock = (key, current) => {
            const amount = prompt("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°:", "10");
            if(amount) update(ref(db, `products/${key}`), { stock: Number(current) + Number(amount) });
        };

        window.deleteOnlineProduct = (key) => { if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) remove(ref(db, `products/${key}`)); };
        window.logout = () => { if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö‡∏ô‡∏≤‡∏¢?")) location.reload(); };
        
        lucide.createIcons();
    </script>
</body>
</html>